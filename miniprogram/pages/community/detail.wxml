<!--pages/community/detail.wxml-->
<view class="detail-container">
  <block wx:if="{{postData}}">
    <!-- é¡¶éƒ¨ä½œè€…æ  -->
    <view class="author-bar">
      <view class="author-left">
        <image class="author-avatar" src="{{postData.author_info.avatar_file_id}}" />
        <view class="author-text">
          <text class="author-name {{postData.author_info.is_certified ? 'certified' : ''}}">{{postData.author_info.nickname}}</text>
          <text class="author-title">{{postData.author_info.is_certified ? (authorData.certified_title || 'éé—ä¼ æ‰¿äºº') : 'éé—çˆ±å¥½è€…'}}</text>
        </view>
      </view>
      <view class="follow-btn {{isFollowing ? 'following' : ''}}">
        <text>{{isFollowing ? 'å·²å…³æ³¨' : '+ å…³æ³¨'}}</text>
      </view>
    </view>

    <!-- å›¾ç‰‡å±•ç¤º -->
    <view class="images-wrapper">
      <!-- å•å›¾å±•ç¤º -->
      <view wx:if="{{postData.images.length === 1}}" class="single-image-wrapper">
        <image 
          class="single-image" 
          src="{{postData.images[0]}}" 
          mode="widthFix"
          bindtap="previewImage"
          data-url="{{postData.images[0]}}"
        />
      </view>
      
      <!-- å¤šå›¾è½®æ’­ -->
      <swiper 
        wx:if="{{postData.images.length > 1}}"
        class="image-swiper"
        style="height: {{swiperHeight}}px;"
        indicator-dots
        indicator-color="rgba(255, 255, 255, 0.5)"
        indicator-active-color="#b63b36"
        circular
        current="{{currentImageIndex}}"
        bindchange="onSwiperChange"
      >
        <swiper-item wx:for="{{postData.images}}" wx:key="index">
          <view class="swiper-item-wrapper">
            <image 
              class="swiper-image" 
              src="{{item}}" 
              mode="widthFix"
              bindtap="previewImage"
              data-url="{{item}}"
              bindload="onImageLoad"
              data-index="{{index}}"
            />
          </view>
        </swiper-item>
      </swiper>
      
      <!-- å›¾ç‰‡è®¡æ•° -->
      <view class="image-indicator" wx:if="{{postData.images.length > 1}}">
        <text>{{currentImageIndex + 1}} / {{postData.images.length}}</text>
      </view>
    </view>

    <!-- å†…å®¹åŒºåŸŸ -->
    <view class="content-section">
      <!-- æ ‡é¢˜ -->
      <view class="post-title">{{postData.title}}</view>
      
      <!-- æ­£æ–‡ -->
      <view class="post-content">{{postData.content}}</view>

      <!-- éé—æ ‡ç­¾ -->
      <view class="project-tags" wx:if="{{postData.related_projects && postData.related_projects.length > 0}}">
        <view 
          class="project-tag-item"
          wx:for="{{postData.related_projects}}"
          wx:key="id"
          bindtap="goToProject"
          data-id="{{item.id}}"
        >
          <text class="tag-icon">ğŸ·ï¸</text>
          <text class="tag-name">{{item.name}}</text>
        </view>
      </view>

      <!-- æ™®é€šæ ‡ç­¾ -->
      <view class="normal-tags" wx:if="{{postData.tags && postData.tags.length > 0}}">
        <view class="normal-tag" wx:for="{{postData.tags}}" wx:key="index">#{{item}}</view>
      </view>

      <!-- ä½ç½®å’Œæ—¶é—´ä¿¡æ¯ -->
      <view class="meta-info">
        <view class="location-info" wx:if="{{postData.location && postData.location.name}}" bindtap="openLocation">
          <van-icon name="location-o" size="14" color="#999" />
          <text class="location-text">{{postData.location.name}}</text>
        </view>
        <view class="time-info">
          <text class="time-text">{{formatTime}}</text>
        </view>
      </view>
    </view>

    <!-- åˆ†éš”çº¿ -->
    <view class="divider-line"></view>

    <!-- è¯„è®ºåŒº -->
    <view class="comment-section">
      <view class="comment-header">
        <text class="comment-title">å…± {{postData.comments ? postData.comments.length : 0}} æ¡è¯„è®º</text>
      </view>

      <!-- è¯„è®ºåˆ—è¡¨ -->
      <view class="comment-list" wx:if="{{postData.comments && postData.comments.length > 0}}">
        <view class="comment-item" wx:for="{{postData.comments}}" wx:key="_id">
          <image class="comment-avatar" src="{{item.user_info.avatar_file_id}}" />
          <view class="comment-content">
            <view class="comment-user">{{item.user_info.nickname}}</view>
            <view class="comment-text">{{item.content}}</view>
            <view class="comment-time">{{item.create_time}}</view>
          </view>
        </view>
      </view>

      <!-- æ— è¯„è®º -->
      <view class="no-comment" wx:if="{{!postData.comments || postData.comments.length === 0}}">
        <text class="no-comment-text">æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘~</text>
      </view>
    </view>

    <!-- åº•éƒ¨äº’åŠ¨æ  -->
    <view class="action-bar">
      <view class="action-input">
        <input 
          class="comment-input" 
          placeholder="è¯´ç‚¹ä»€ä¹ˆ..." 
          disabled
        />
      </view>
      <view class="action-icons">
        <view class="action-icon-item">
          <van-icon name="like-o" size="22" color="#333" />
          <text class="action-count">{{likesFormatted}}</text>
        </view>
        <view class="action-icon-item">
          <van-icon name="star-o" size="22" color="#333" />
          <text class="action-count">0</text>
        </view>
        <view class="action-icon-item">
          <van-icon name="chat-o" size="22" color="#333" />
          <text class="action-count">{{commentsFormatted}}</text>
        </view>
      </view>
    </view>
  </block>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-wrapper" wx:if="{{loading}}">
    <van-loading type="spinner" color="#b63b36" size="40">åŠ è½½ä¸­...</van-loading>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-wrapper" wx:if="{{!loading && !postData}}">
    <van-empty description="å¸–å­ä¸å­˜åœ¨" />
  </view>
</view>

