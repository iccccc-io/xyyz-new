<!--pages/community/topic.wxml-->
<view class="topic-page">
  <!-- æ²‰æµ¸å¼å¤´éƒ¨ Hero Header -->
  <view class="hero-header" style="padding-top: {{statusBarHeight + 44}}px;">
    <!-- æ¨¡ç³ŠèƒŒæ™¯å±‚ -->
    <view class="hero-bg">
      <image 
        wx:if="{{heroImage}}" 
        class="hero-bg-image" 
        src="{{heroImage}}" 
        mode="aspectFill"
      />
      <view class="hero-bg-overlay"></view>
    </view>
    
    <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
    <view class="custom-navbar" style="top: {{statusBarHeight}}px;">
      <view class="navbar-left" bindtap="goBack">
        <van-icon name="arrow-left" size="20" color="#fff" />
      </view>
      <!-- æ ‡é¢˜ç•™ç©º -->
      <view class="navbar-title"></view>
      <view class="navbar-right" bindtap="onShare">
        <van-icon name="share-o" size="20" color="#fff" />
      </view>
    </view>
    
    <!-- å¤´éƒ¨å†…å®¹ -->
    <view class="hero-content animate-fade-up">
      <!-- è¯é¢˜å›¾æ ‡ -->
      <view class="topic-avatar">
        <text class="topic-avatar-text">#</text>
      </view>
      
      <!-- è¯é¢˜ä¿¡æ¯ -->
      <view class="topic-meta">
        <view class="topic-name-row">
          <text class="topic-hash">#</text>
          <text class="topic-name">{{tagName}}</text>
        </view>
        <!-- ç»Ÿè®¡è¡Œï¼šå·¦ä¾§æ•°æ® + å³ä¾§ Tab åˆ‡æ¢ -->
        <view class="topic-bottom-row">
          <view class="topic-stats-row">
            <view class="stat-item">
              <text class="stat-value">{{topicStats.viewCountFormatted || '0'}}</text>
              <text class="stat-label">æµè§ˆ</text>
            </view>
            <view class="stat-divider"></view>
            <view class="stat-item">
              <text class="stat-value">{{topicStats.countFormatted || '0'}}</text>
              <text class="stat-label">ç¯‡ç¬”è®°</text>
            </view>
          </view>
          <!-- Tab åˆ‡æ¢ï¼šæ–‡å­—å½¢å¼ -->
          <view class="inline-tabs">
            <text 
              class="inline-tab {{activeTab === 'hot' ? 'active' : ''}}" 
              bindtap="onTabTap"
              data-tab="hot"
            >çƒ­é—¨</text>
            <text class="tab-separator">|</text>
            <text 
              class="inline-tab {{activeTab === 'latest' ? 'active' : ''}}" 
              bindtap="onTabTap"
              data-tab="latest"
            >æœ€æ–°</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¸–å­åˆ—è¡¨å®¹å™¨ -->
  <view class="post-list-container">
    <!-- è½»é‡çº§åŠ è½½æŒ‡ç¤ºå™¨ï¼ˆTab åˆ‡æ¢æ—¶æ˜¾ç¤ºï¼‰ -->
    <view class="tab-loading-overlay" wx:if="{{tabSwitching}}">
      <view class="tab-loading-spinner"></view>
    </view>

    <!-- é¦–æ¬¡åŠ è½½ä¸­ -->
    <view class="loading-container" wx:if="{{loading && postList.length === 0 && !tabSwitching}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ç€‘å¸ƒæµå¸ƒå±€ -->
    <view class="waterfall animate-stagger" wx:if="{{postList.length > 0}}">
      <view class="waterfall-column left">
        <view 
          class="post-card" 
          wx:for="{{leftColumn}}" 
          wx:key="_id"
          bindtap="goToDetail"
          data-id="{{item._id}}"
          data-isliked="{{item.isLiked}}"
          style="animation-delay: {{index * 60}}ms;"
        >
          <!-- å°é¢å›¾ -->
          <view class="card-image-wrapper">
            <image 
              class="post-cover" 
              src="{{item.images[0]}}" 
              mode="widthFix"
              lazy-load
            />
          </view>
          <!-- å†…å®¹åŒº -->
          <view class="post-content">
            <view class="post-title">{{item.title || 'åˆ†äº«ä¸€ä¸‹'}}</view>
            <view class="post-footer">
              <view class="author-info">
                <image class="author-avatar" src="{{item.author_info.avatar_file_id}}" />
                <text class="author-name">{{item.author_info.nickname}}</text>
              </view>
              <view class="like-btn {{item.isLiked ? 'liked' : ''}}">
                <van-icon 
                  name="{{item.isLiked ? 'like' : 'like-o'}}" 
                  size="14" 
                  color="{{item.isLiked ? '#b63b36' : '#999'}}"
                />
                <text class="like-num">{{item.likesFormatted || item.likes || 0}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <view class="waterfall-column right">
        <view 
          class="post-card" 
          wx:for="{{rightColumn}}" 
          wx:key="_id"
          bindtap="goToDetail"
          data-id="{{item._id}}"
          data-isliked="{{item.isLiked}}"
          style="animation-delay: {{(index * 60) + 30}}ms;"
        >
          <!-- å°é¢å›¾ -->
          <view class="card-image-wrapper">
            <image 
              class="post-cover" 
              src="{{item.images[0]}}" 
              mode="widthFix"
              lazy-load
            />
          </view>
          <!-- å†…å®¹åŒº -->
          <view class="post-content">
            <view class="post-title">{{item.title || 'åˆ†äº«ä¸€ä¸‹'}}</view>
            <view class="post-footer">
              <view class="author-info">
                <image class="author-avatar" src="{{item.author_info.avatar_file_id}}" />
                <text class="author-name">{{item.author_info.nickname}}</text>
              </view>
              <view class="like-btn {{item.isLiked ? 'liked' : ''}}">
                <van-icon 
                  name="{{item.isLiked ? 'like' : 'like-o'}}" 
                  size="14" 
                  color="{{item.isLiked ? '#b63b36' : '#999'}}"
                />
                <text class="like-num">{{item.likesFormatted || item.likes || 0}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-container" wx:if="{{!loading && !tabSwitching && postList.length === 0}}">
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-title">æš‚æ— ç›¸å…³ç¬”è®°</view>
      <view class="empty-desc">æˆä¸ºç¬¬ä¸€ä¸ªåˆ†äº«çš„äººå§</view>
      <view class="empty-action" bindtap="goToPost">
        <text>å»å‘å¸ƒ</text>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{postList.length > 0 && !noMore}}">
      <view class="loading-dots" wx:if="{{loadingMore}}">
        <view class="dot"></view>
        <view class="dot"></view>
        <view class="dot"></view>
      </view>
      <text wx:else class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤šäº† -->
    <view class="no-more" wx:if="{{noMore && postList.length > 0}}">
      <view class="no-more-line"></view>
      <text class="no-more-text">å·²ç»åˆ°åº•äº†</text>
      <view class="no-more-line"></view>
    </view>
  </view>

  <!-- åº•éƒ¨æµ®åŠ¨å‘å¸ƒæŒ‰é’® -->
  <view class="fab-button" bindtap="goToPost">
    <van-icon name="edit" size="22" color="#fff" />
    <text class="fab-text">å‘ç¬”è®°</text>
  </view>
</view>
