<!--pages/mall/category.wxml-->
<view class="category-container">
  <!-- å·¦ä¾§åˆ†ç±»ä¾§è¾¹æ  -->
  <view class="sidebar-wrap">
    <van-sidebar active-key="{{ activeIndex }}" bind:change="onCategoryChange">
      <van-sidebar-item 
        wx:for="{{categories}}" 
        wx:key="id"
        title="{{item.name}}"
      />
    </van-sidebar>
  </view>

  <!-- å³ä¾§å•†å“å±•ç¤ºåŒº -->
  <scroll-view 
    class="content-wrap" 
    scroll-y 
    enhanced
    bindscrolltolower="onReachBottom"
  >
    <!-- åˆ†ç±»æ ‡é¢˜ -->
    <view class="content-header">
      <text class="header-title">{{categories[activeIndex].name}}</text>
      <text class="header-count">å…±{{products.length}}ä»¶å•†å“</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <van-loading size="24px" color="#8B2E2A">åŠ è½½ä¸­...</van-loading>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <van-empty 
      wx:elif="{{products.length === 0}}"
      image="search"
      description="è¯¥åˆ†ç±»æš‚æ— å•†å“"
    />

    <!-- å•†å“åˆ—è¡¨ (List View) -->
    <view class="products-list" wx:else>
      <view 
        class="product-row"
        wx:for="{{products}}"
        wx:key="_id"
        bindtap="goToDetail"
        data-id="{{item._id}}"
      >
        <!-- å·¦ä¾§æ­£æ–¹å½¢å›¾ç‰‡ -->
        <view class="row-image-wrap">
          <image 
            class="row-image" 
            src="{{item.cover_img}}" 
            mode="aspectFill"
            lazy-load
          />
        </view>
        <!-- å³ä¾§ä¿¡æ¯åŒº -->
        <view class="row-info">
          <text class="row-title">{{item.title}}</text>
          <!-- æ ‡ç­¾è¡Œ -->
          <view class="row-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="row-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</text>
          </view>
          <!-- äº§åœ° -->
          <view class="row-origin">
            <text class="origin-icon">ğŸ“</text>
            <text class="origin-text">{{item.origin || 'æ¹–å—'}}</text>
          </view>
          <!-- ä»·æ ¼ä¸é”€é‡ -->
          <view class="row-footer">
            <view class="row-price">
              <text class="price-symbol">Â¥</text>
              <text class="price-value">{{item.price}}</text>
              <text class="price-original" wx:if="{{item.original_price}}">Â¥{{item.original_price}}</text>
            </view>
            <text class="row-sales">å·²å”®{{item.sales || 0}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š / æ²¡æœ‰æ›´å¤š -->
    <view class="list-footer" wx:if="{{products.length > 0}}">
      <van-loading size="18px" color="#8B2E2A" wx:if="{{!noMore && !loading}}" />
      <text class="footer-text" wx:elif="{{noMore}}">â€” å·²å±•ç¤ºå…¨éƒ¨ â€”</text>
    </view>
  </scroll-view>
</view>

