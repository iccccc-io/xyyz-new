<!--pages/mall/topic.wxml-->
<view class="topic-container">
  <!-- ä¸“é¢˜å¤´éƒ¨ Banner -->
  <view class="topic-header" wx:if="{{currentTopic}}" style="background: linear-gradient(135deg, {{currentTopic.color}} 0%, {{currentTopic.color}}dd 100%);">
    <view class="header-content">
      <view class="header-icon">
        <van-icon name="{{currentTopic.icon}}" size="48" color="#ffffff" />
      </view>
      <view class="header-text">
        <text class="header-title">{{currentTopic.title}}</text>
        <text class="header-subtitle">{{currentTopic.subtitle}}</text>
      </view>
    </view>
    <view class="header-decoration">
      <view class="deco-circle deco-1"></view>
      <view class="deco-circle deco-2"></view>
      <view class="deco-circle deco-3"></view>
    </view>
  </view>

  <!-- å•†å“æ•°é‡ç»Ÿè®¡ -->
  <view class="stats-bar">
    <text class="stats-text">å…± {{leftColumn.length + rightColumn.length}} ä»¶å¥½ç‰©</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <van-loading size="24px" color="#8B2E2A">åŠ è½½ä¸­...</van-loading>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <van-empty 
    wx:elif="{{leftColumn.length === 0 && rightColumn.length === 0}}"
    image="search"
    description="è¯¥ä¸“é¢˜æš‚æ— å•†å“"
  />

  <!-- å•†å“ç€‘å¸ƒæµ -->
  <view class="waterfall-container" wx:else>
    <!-- å·¦åˆ— -->
    <view class="waterfall-column">
      <view 
        class="product-card"
        wx:for="{{leftColumn}}"
        wx:key="_id"
        bindtap="goToDetail"
        data-id="{{item._id}}"
      >
        <view class="card-image-wrap">
          <image 
            class="card-image" 
            src="{{item.cover_img}}" 
            mode="widthFix"
            lazy-load
          />
          <!-- æ ‡ç­¾ -->
          <view class="card-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="card-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this" wx:if="{{tag !== keyword}}">{{tag}}</text>
          </view>
        </view>
        <view class="card-content">
          <text class="card-title">{{item.title}}</text>
          <view class="card-origin">
            <text class="origin-icon">ğŸ“</text>
            <text class="origin-text">{{item.origin || 'æ¹–å—'}}</text>
          </view>
          <view class="card-footer">
            <view class="price-wrap">
              <text class="current-price">Â¥{{item.price}}</text>
              <text class="original-price" wx:if="{{item.original_price}}">Â¥{{item.original_price}}</text>
            </view>
            <text class="sales-text">å·²å”®{{item.sales || 0}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å³åˆ— -->
    <view class="waterfall-column">
      <view 
        class="product-card"
        wx:for="{{rightColumn}}"
        wx:key="_id"
        bindtap="goToDetail"
        data-id="{{item._id}}"
      >
        <view class="card-image-wrap">
          <image 
            class="card-image" 
            src="{{item.cover_img}}" 
            mode="widthFix"
            lazy-load
          />
          <!-- æ ‡ç­¾ -->
          <view class="card-tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="card-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this" wx:if="{{tag !== keyword}}">{{tag}}</text>
          </view>
        </view>
        <view class="card-content">
          <text class="card-title">{{item.title}}</text>
          <view class="card-origin">
            <text class="origin-icon">ğŸ“</text>
            <text class="origin-text">{{item.origin || 'æ¹–å—'}}</text>
          </view>
          <view class="card-footer">
            <view class="price-wrap">
              <text class="current-price">Â¥{{item.price}}</text>
              <text class="original-price" wx:if="{{item.original_price}}">Â¥{{item.original_price}}</text>
            </view>
            <text class="sales-text">å·²å”®{{item.sales || 0}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="loading-more" wx:if="{{loadingMore}}">
    <van-loading size="20px" color="#8B2E2A" />
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{noMore && (leftColumn.length > 0 || rightColumn.length > 0)}}">
    <view class="no-more-line"></view>
    <text class="no-more-text">å·²å±•ç¤ºå…¨éƒ¨å¥½ç‰©</text>
    <view class="no-more-line"></view>
  </view>
</view>

