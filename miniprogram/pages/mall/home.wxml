<!--pages/mall/home.wxml-->
<view class="mall-container">
  <!-- æ²‰æµ¸å¼é¡¶éƒ¨ -->
  <view class="header">
    <view class="header-bg"></view>
    <view class="header-content">
      <view class="header-title">
        <text class="title-main">æ–‡åˆ›å¥½ç‰©</text>
        <text class="title-sub">åŒ å¿ƒä¼ æ‰¿ Â· éé—æ–°ç”Ÿ</text>
      </view>
      <!-- æ¯›ç»ç’ƒæœç´¢æ¡ -->
      <view class="search-bar">
        <van-search
          value="{{ searchValue }}"
          placeholder="æœç´¢éé—å¥½ç‰©..."
          shape="round"
          background="transparent"
          bind:change="onSearchInput"
          bind:search="onSearch"
          bind:clear="onSearchClear"
        />
      </view>
    </view>
  </view>

  <!-- æ¯æ—¥ä¸€ç‰© Hero Card -->
  <view class="hero-section" wx:if="{{featuredProduct}}">
    <view class="hero-card" bindtap="goToDetail" data-id="{{featuredProduct._id}}">
      <view class="hero-label">
        <text class="label-text">åŒ </text>
        <text class="label-text">å¿ƒ</text>
        <text class="label-divider"></text>
        <text class="label-text">æ¨</text>
        <text class="label-text">è</text>
      </view>
      <view class="hero-image-wrap">
        <image 
          class="hero-image" 
          src="{{featuredProduct.cover_img}}" 
          mode="aspectFill"
        />
        <view class="hero-overlay">
          <view class="hero-info">
            <text class="hero-title">{{featuredProduct.title}}</text>
            <view class="hero-price-row">
              <text class="hero-price">Â¥{{featuredProduct.price}}</text>
              <text class="hero-origin">ğŸ“ {{featuredProduct.origin || 'æ¹–å—'}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·å…¥å£å¯¼èˆª -->
  <view class="category-section">
    <scroll-view scroll-x class="category-scroll" enhanced show-scrollbar="{{false}}">
      <view class="category-list">
        <view 
          class="category-item"
          wx:for="{{quickEntries}}"
          wx:key="id"
          data-id="{{item.id}}"
          data-type="{{item.type}}"
          bindtap="onEntryTap"
        >
          <view class="category-icon-wrap">
            <van-icon name="{{item.icon}}" size="24" color="#8B2E2A" />
          </view>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- ç‰¹è‰²ä¸“åŒº - éé—å·¥åŠç›´ä¾› -->
  <view class="workshop-section" wx:if="{{workshops.length > 0}}">
    <view class="section-header">
      <view class="section-title-wrap">
        <view class="title-decoration"></view>
        <text class="section-title">éé—å·¥åŠç›´ä¾›</text>
        <view class="title-decoration"></view>
      </view>
      <text class="section-subtitle">æºå¤´ç›´é‡‡ Â· åŒ äººåŒ å¿ƒ</text>
    </view>
    
    <scroll-view 
      scroll-x 
      class="workshop-scroll" 
      enhanced 
      show-scrollbar="{{false}}"
    >
      <view class="workshop-list">
        <view 
          class="workshop-card"
          wx:for="{{workshops}}"
          wx:key="id"
          bindtap="goToDetail"
          data-id="{{item.product._id}}"
        >
          <!-- å·¥åŠå›¾ç‰‡ï¼ˆä»£è¡¨ä½œï¼‰ -->
          <view class="workshop-image-wrap">
            <image 
              class="workshop-image" 
              src="{{item.product.cover_img}}" 
              mode="aspectFill"
            />
            <view class="workshop-badge">
              <van-icon name="shop-o" size="12" color="#fff" />
              <text>ç›´ä¾›</text>
            </view>
          </view>
          <!-- å·¥åŠä¿¡æ¯ -->
          <view class="workshop-info">
            <text class="workshop-name">{{item.name}}</text>
            <view class="workshop-meta">
              <text class="workshop-origin">ğŸ“ {{item.origin}}</text>
            </view>
            <view class="workshop-product">
              <text class="product-label">ä»£è¡¨ä½œï¼š</text>
              <text class="product-name">{{item.product.title}}</text>
            </view>
            <view class="workshop-price">
              <text class="price-symbol">Â¥</text>
              <text class="price-value">{{item.product.price}}</text>
              <text class="price-suffix">èµ·</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å¥½ç‰©å¸‚é›† - ç€‘å¸ƒæµ -->
  <view class="products-section">
    <view class="section-header">
      <view class="section-title-wrap">
        <view class="title-decoration"></view>
        <text class="section-title">å¥½ç‰©å¸‚é›†</text>
        <view class="title-decoration"></view>
      </view>
      <text class="section-subtitle">æ¯ä¸€ä»¶éƒ½æ˜¯éé—çš„æ¸©åº¦</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <van-loading size="24px" color="#8B2E2A">åŠ è½½ä¸­...</van-loading>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <van-empty 
      wx:elif="{{leftColumn.length === 0 && rightColumn.length === 0}}"
      description="æš‚æ— å•†å“"
    />

    <!-- å•†å“ç€‘å¸ƒæµ -->
    <view class="waterfall-container" wx:else>
      <!-- å·¦åˆ— -->
      <view class="waterfall-column">
        <view 
          class="product-card"
          wx:for="{{leftColumn}}"
          wx:key="_id"
          bindtap="goToDetail"
          data-id="{{item._id}}"
        >
          <view class="card-image-wrap">
            <image 
              class="card-image" 
              src="{{item.cover_img}}" 
              mode="widthFix"
              lazy-load
            />
            <!-- æ ‡ç­¾ -->
            <view class="card-tags" wx:if="{{item.tags && item.tags.length > 0}}">
              <text class="card-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</text>
            </view>
          </view>
          <view class="card-content">
            <text class="card-title">{{item.title}}</text>
            <view class="card-origin">
              <text class="origin-icon">ğŸ“</text>
              <text class="origin-text">{{item.origin || 'æ¹–å—'}}</text>
            </view>
            <view class="card-footer">
              <view class="price-wrap">
                <text class="current-price">Â¥{{item.price}}</text>
                <text class="original-price" wx:if="{{item.original_price}}">Â¥{{item.original_price}}</text>
              </view>
              <text class="sales-text">å·²å”®{{item.sales || 0}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- å³åˆ— -->
      <view class="waterfall-column">
        <view 
          class="product-card"
          wx:for="{{rightColumn}}"
          wx:key="_id"
          bindtap="goToDetail"
          data-id="{{item._id}}"
        >
          <view class="card-image-wrap">
            <image 
              class="card-image" 
              src="{{item.cover_img}}" 
              mode="widthFix"
              lazy-load
            />
            <!-- æ ‡ç­¾ -->
            <view class="card-tags" wx:if="{{item.tags && item.tags.length > 0}}">
              <text class="card-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</text>
            </view>
          </view>
          <view class="card-content">
            <text class="card-title">{{item.title}}</text>
            <view class="card-origin">
              <text class="origin-icon">ğŸ“</text>
              <text class="origin-text">{{item.origin || 'æ¹–å—'}}</text>
            </view>
            <view class="card-footer">
              <view class="price-wrap">
                <text class="current-price">Â¥{{item.price}}</text>
                <text class="original-price" wx:if="{{item.original_price}}">Â¥{{item.original_price}}</text>
              </view>
              <text class="sales-text">å·²å”®{{item.sales || 0}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="loading-more" wx:if="{{loadingMore}}">
      <van-loading size="20px" color="#8B2E2A" />
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{noMore && (leftColumn.length > 0 || rightColumn.length > 0)}}">
      <view class="no-more-line"></view>
      <text class="no-more-text">å·²å±•ç¤ºå…¨éƒ¨å¥½ç‰©</text>
      <view class="no-more-line"></view>
    </view>
  </view>
</view>

